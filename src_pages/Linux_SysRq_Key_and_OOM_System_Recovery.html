<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22></text></svg>">
    
    <title data-i18n="source-page-title">MBook - Linux Magic SysRq Key and OOM</title>
    <meta name="description" content="Command for recovering frozen Linux machine using the SysRq keybinding." />
    <meta name=generator content="MWiki">
    
   
    
   <style>

@font-face {
    font-family: 'CMU Concrete';
    
    font-style: normal;
    
    
    
    src: url('/mwiki/static/fonts/cmu-concrete-regular.woff');
    
}
    


@font-face {
    font-family: 'CMU Concrete';
    
    font-style: italic;
    
    
    
    src: url('/mwiki/static/fonts/cmu-concrete-italic.woff');
    
}
    

@font-face {
    font-family: 'Libertinus Mono';
    
    
    
    src: url('/mwiki/static/fonts/LibertinusMono-Regular.woff2');
    
}
    

@font-face {
    font-family: 'Chicago MacOS';
    
    
    
    src: url('/mwiki/static/fonts/ChicagoFLF.ttf');
    
}
    

:root {
    /*--- Desktop screen Width ----------------*/
    --screen-width-desktop: 850px;

    /* --bg-sidebar: #F2EACA; */  /* #F7F4ED; */
    --bg-sidebar: white;  /* #F7F4ED; */
    /* --bg-main:   #F2EACA ; */
    --bg-main: white;
    --typography-main-line-height: 1.7em;
    --typography-main-leter-spacing: 0.5px;
    --screen-type: "desktop";
    --link-external-color: blue; /* hsl(0, 100%, 33%); */
    --link-internal-color: blue;
    --form-background-color: #fbfcfc;
    --form-border-color: #cfd5e2;
    --primary-button-background-color: #0172ad;


    
    --font-family-main: 'CMU Concrete';
    
    
    --font-family-title: 'Chicago MacOS';
    

    --font-size-h1:  1.800rem;
    --font-size-h2:  1.350rem;
    --font-size-h3:  1.125rem;
    --font-size-h4:  1.000rem;
    --font-size-h5:  0.875rem;
    --font-size-h6:  0.750rem;
    --font-size-text: 0.720rem;
    --font-size-code: 0.700rem;
    --font-size-sidebar: 0.850rem;

    --code-block-background-color: rgb(243, 244.5, 246.75);

    /* Magnifier icon */
    --icon-search: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(136, 145, 164)' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3C/svg%3E");
}


        
    </style>
  
    
    <link rel="stylesheet" href="/mwiki/static/static_style.css">
    
    
    
    <!-- MathJax Settings -->
    <script>

    const FONT_FAMILY_MAIN = "CMU Concrete"
    const FONT_FAMILY_TITLE = "Chicago MacOS"
    const FONT_FAMILY_CODE = "Libertinus Mono"
    const DEFAULT_LOCALE = "en-US";
	  const USE_DEFAULT_LOCALE = "True" === "True";
    const LATEX_RENDERER = "";
    const IS_LATEX_RENDERER_MATHJAX = LATEX_RENDERER === "mathjax";
    const IS_LATEX_RENDERER_KATEX   = LATEX_RENDERER === "katex";
    const KATEX_MACROS = "";
    const CSRF_TOKEN = ""
    const STATIC_COMPILATION = true;
    const IS_USER_ADMIN = false;
    // NOTE: It is encoded as base64 
    const PAGE_SOURCE_CODE = "";
    const PAGE_SOURCE_URL  = ""
    const CITATION_REFERENCES = "";
	
    // Possible values: 'none', 'nosection' 'section', 'subsection'
    //  none      => no enumeration 
    //  nosection 
    //      Schema: <equation-number>
    //      Example: Equations are enumerated as 1, 2, ..., 200
    //              in the order that they are shown without section or 
    //              subsection number
    //  section   
    //      Schema:  => <section>.<equation-number>
    //      Exmaple: => 2.1, 2.5, 6.8
    //  subsection 
    //      Schema:  => <section>.<subsection>.<equation-number>
    //      Example: => 1.3.1 , 1.3.2, 2.4.5 
    //
    let equation_enumeration = "";

    MathJax = {
        loader: {load: ['[tex]/tagformat', '[tex]/mathtools', 'output/chtml']}

      , section: 1
      , tex: {
          inlineMath: [['$','$'], ['\\(','\\)']]
        , displayMath: [['$$','$$'], ['\\[','\\]']]
        , processEscapes: true
        , processEnvironments: true
          // Location of equation numbers
        , tagSide: "right"  
        // Possible values 'ams' or 'all' (all equations are numbered by default)
        , tags: equation_enumeration !== "none" ? "all" : "ams"
        //, tags: 'ams'
        , packages: {'[+]': [
                                  'tagformat'
                                , 'sections'
                                , 'subsections'
                                , 'autoload-all'
                            ]}
        , tagformat: {
          number: (n) => { 
            if( equation_enumeration === "cont" 
                || equation_enumeration == "continuous")
            {
                return '' + n;
            }

            let nsec = MathJax.config.section;
            let nsub = MathJax.config.subsection;
            var out = '';
            if (nsub === 0 || equation_enumeration == "section") 
            {
                out = nsec + '.' + n;
            } else {
                out = nsec + '.' + nsub +  '.' + n;
            }
            // console.log("Display section = ", out);
            return out;
          }
        }
      }

     , startup: {

            ready() {
                // console.log(" [TRACE] I was called from ready()");
                const Configuration = MathJax._.input.tex.Configuration.Configuration;
                const CommandMap = MathJax._.input.tex.SymbolMap.CommandMap;
                new CommandMap('sections', {
                      nextSection: 'NextSection'
                    , setSection:  'SetSection'
                }, {
                     NextSection(parser, name) {
                        // console.log(" [TRACE] Called NextSection()");
                        MathJax.config.section++;
                        MathJax.config.subsection = 0;
                        parser.tags.counter = parser.tags.allCounter = 0;
                    }
                    , SetSection(parser, name) {
                        // console.log(" [TRACE] Called SetSection()");
                        const n = parser.GetArgument(name);
                        MathJax.config.section = parseInt(n);
                        parser.tags.counter = parser.tags.allCounter = 0;
                    }
                });
                if (equation_enumeration === "subsection")
                {
                    new CommandMap('subsections', {
                          nextSubSection: 'NextSubSection'
                        , setSubSection:  'SetSubSection'
                    }, {
                         NextSubSection(parser, name) {
                            // console.log(" [TRACE] NextSubSection() called.");
                            MathJax.config.subsection++;
                            parser.tags.counter = parser.tags.allCounter = 0;
                        }
                        , SetSubSection(parser, name) {
                            const n = parser.GetArgument(name);
                            // console.log(" [TRACE] SetSubSection to ", n);
                            MathJax.config.subsection = parseInt(n);
                            parser.tags.counter = parser.tags.allCounter = 0;
                        }
                    });
                }

                Configuration.create(
                      'sections', { handler: { macro: ['sections'] } }
                );

                if( equation_enumeration === "subsection" )
                {
                    Configuration.create(
                        'subsections', { handler: { macro: ['subsections'] } }
                    );

                }

                MathJax.startup.defaultReady();
                pseudocode.renderClass("pseudocode", { "lineNumber": true, "scopeLines": true });
                // This function is provided by main.js.
                if( isMobileScreen() ) { setHeadingVisibility(false); }
                /// setHeadingsVisibility(false)
            }
        }
    , chtml: {
        /// displayAlign: "left"
      }
    // options for when overflow is linebreak
    , linebreaks: {             
        inline:           true,   // true for browser-based breaking of inline equations
        width:            '100%', // a fixed size or a percentage of the container width
        lineleading:      .2,     // the default lineleading in em units
        LinebreakVisitor: null,   // The LinebreakVisitor to use
    },

    }
    </script>

    

    
  

    


    

    
    <!-- Additional Javascript libraries -->
    


    <script>

        document.addEventListener("DOMContentLoaded", (event) => {
            // Select graphviz code blocks 
            let lst = document.querySelectorAll(".graphviz-dot");
            for(let x of lst){

                Viz.instance().then(function(viz) {
                    // console.log("[TRACE] x = ", x);
                    let code = x.innerText;
                    // console.log(" [TRACE] code = ", code);
                    let svg = viz.renderSVGElement(code);
                    // console.log(" [TRACE] svg = ", svg);
                    x.replaceWith(svg); 
                    // x.outerHTML = svg;
                    /// document.getElementById("graph").appendChild(svg);
                });


            }
        }, false);
        
    </script>

    
    <script type="text/javascript" src="/mwiki/static/main.js"></script>
    

</head>

<body>

    
    
    <div class="main main-shift">
        

        <main class="content">
            
            <p class="hidden-mathjax-macros" style="display: none;">
                $$
                
                $$
            </p>
            <div class="highlight"><pre><span></span>---
title:       Linux Magic SysRq Key and OOM
lable:       
description: Command for recovering frozen Linux machine using the SysRq keybinding.
<span class="gu">keywords:    </span>
<span class="gu">---</span>

<span class="gu">## Overview</span>

Unlike MacOSX and Microsoft Windows NT, the Linux kernel and consequentely, Linux distributions still have an OOM - Out-Of-Memory bug, which freezes the computer and makes it unresponsive when almost all memory is used. This issue is annoying as even the keyboard becomes unresponsive and key combination similar to Windows&#39; Ctrl+Al+Del for invoking a process manager does not work. 

For many users, the solution is a forced system reboot. However, it may lead to data loss, data corruption and loss of productivity. An alternative to system reboot is the Linux&#39;s kernel <span class="gs">**magic SysReq**</span> key combination, which is available in Linux kenels compiled with CONFIG_MAGIC_SYSREQ option enabled. Nowadays, most Linux distributions are shipped with a kernel using this option enabled. In order to  use SysReq keyboard shortcut for system recovery, it is necessary to enable it either temporarily or permanently by editing the appropriate configuration file.
  
<span class="gu">## SysRq Settings</span>

<span class="gu">### Check whether SysRq status</span>

To check whether SysRq is eanabled, run 

<span class="sb">```sh</span>
$<span class="w"> </span>cat<span class="w"> </span>/proc/sys/kernel/sysrq
<span class="m">1</span>
<span class="sb">```</span>

if the output is 0, then sysrq is disabled, otherwise sysrq is enabled. All sysrq functions are only enabled when this pseudo-file, created by the Linux kernel, is set to 1. 

<span class="gu">### Set SySrq Value without reboot</span>

Enable all SysRq options/functions.

<span class="sb">```sh</span>
$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>kernel.sysrq<span class="o">=</span><span class="m">1</span>
<span class="sb">```</span>

All SysRq options can be enabled by setting the pseudo-file (a kernel interface) using the command.

<span class="sb">```sh</span>
$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/proc/sys/kernel/sysrq
<span class="sb">```</span>

<span class="gu">### Persist SysRq Value on Reboot</span>

Create backup of the configuration file.

<span class="sb">```sh</span>
$<span class="w"> </span>sudo<span class="w"> </span>cp<span class="w"> </span>/etc/sysctl.d/99-sysctl.conf<span class="w"> </span>-v<span class="w"> </span>/etc/sysctl.d/99-sysctl.conf.back
<span class="sb">```</span>

Override the file 99-sysctl.conf with the line <span class="sb">`kernel.sysrq = 1`</span>. 

<span class="sb">```sh</span>
$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;kernel.sysrq = 1&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/sysctl.d/99-sysctl.conf
<span class="sb">```</span>


<span class="gu">## Commands</span>

SysRq key-combination provide the following commands.

<span class="k">-</span><span class="w"> </span>b – reboots the computer
<span class="k">-</span><span class="w"> </span>e – ask all processes to terminate gracefully
<span class="k">-</span><span class="w"> </span>f – to get rid of an [<span class="nt">Out Of Memory condition</span>](<span class="na">https://en.wikipedia.org/wiki/Out_of_memory &quot;Out Of Memory Condition&quot;</span>) via oom\_kills
<span class="k">-</span><span class="w"> </span>i – to kill all processes immediately except init
<span class="k">-</span><span class="w"> </span>k – to kill absolutely all processes, including X
<span class="k">-</span><span class="w"> </span>m – to output the current memory information
<span class="k">-</span><span class="w"> </span>o – to shut down the computer
<span class="k">-</span><span class="w"> </span>r – very useful, to take the keyboard out of the X server control
<span class="k">-</span><span class="w"> </span>s – to sync data from all mounted devices (avoid data loss in case of violent reboot)
<span class="k">-</span><span class="w"> </span>t – to display a list of the current tasks
<span class="k">-</span><span class="w"> </span>u – to remount all file system in read-only mode
 

<span class="gu">### Unfreeze Computer in OOM </span>

Unfreeze computer in OOM (Out-Of-Memory) by terminating memory hogging processes.

+ <span class="gs">**SysRq + Alt + f**</span> 

<span class="gu">### Safe System Reboot</span>

Safe system reboot with graceful termination of processes for avoiding data loss and file system damage.

+ <span class="gs">**Alt + SysRq + reisub**</span>

This keybinding peforms the following sequence of operations.

<span class="k">-</span><span class="w"> </span>(r) - Take the keyboard from X
<span class="k">-</span><span class="w"> </span>(e) - Ask all programs to end gently
<span class="k">-</span><span class="w"> </span>(i) Kill the one who did not
<span class="k">-</span><span class="w"> </span>(s) - Save the data from the cache to the hard drive
<span class="k">-</span><span class="w"> </span>(u) - Remounts the file systems
<span class="k">-</span><span class="w"> </span>(b) - Reboot

reisub meneumonic: 

  + opposite of &quot;busier&quot;
  + &quot;[R]aising an [E]lephant is so [U]tterly [B]oring&quot;
<span class="gu">## See </span>

+ <span class="ge">*Linux Magic System Request Key Hacks*</span>, Kernel\.org
  + https://www.kernel.org/doc/html/latest/admin-guide/sysrq.html
+ <span class="ge">*How to enable all SysRq functions on Linux*</span>, Linux Config (2020)
  + https://linuxconfig.org/how-to-enable-all-sysrq-functions-on-linux 
+ <span class="ge">*Understanding the SysRq Key – The Magic Key To Control Linux*</span>, MakeTechEasier (2012)
  + https://www.maketecheasier.com/the-usage-of-sysrq-key-in-linux/ 
+ <span class="ge">*What is /proc/sysrq-trigger in linux and how to use sysrq kernel feature ?*</span>
  + https://ngelinux.com/what-is-proc-sysrq-trigger-in-linux-and-how-to-use-sysrq-kernel-feature/
+ <span class="ge">*Use the Magic SysRq Key on Linux to Fix Frozen X Servers, Cleanly Reboot, and Run Other Low-Level Commands*</span>, Chris Hoffman, How-To Geek (2012)
  + https://www.howtogeek.com/119127/use-the-magic-sysrq-key-on-linux-to-fix-frozen-x-servers-cleanly-reboot-and-run-other-low-level-commands/
</pre></div>

        </main>

        
        <style>
            .highlight {
                max-height: none !important;
            }

            .highlight pre {
                overflow-wrap: break-word;
                word-break: break-word;
                text-wrap: balance;
            }

            .content {
                width: 100% !important;
                height: 100% !important;
                margin-left: -50px !important;
            }
 
            .sidebar {
                display: none;
            }
        </style>
        
    </div>
    <script>
    </script>

</body>

</html>